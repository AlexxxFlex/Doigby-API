@if (isLoading) {
  <div class="loading-container">
    <p>Chargement du produit...</p>
  </div>
} @else if (error) {
  <div class="error-container">
    <h2>{{ error }}</h2>
    <button class="back-button" (click)="goBack()">
      Retour à l'accueil
    </button>
  </div>
} @else if (product) {
  <div class="product-details-container">
    <button class="back-button" (click)="goBack()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
      Retour
    </button>

    <div class="product-details-content">
      <div class="product-gallery">
        <div class="main-image">
          <img [src]="selectedImage" [alt]="product.name" />
          @if (!isAvailable()) {
            <span class="out-of-stock-badge">Rupture de stock</span>
          }
        </div>
        
        @if (product.images && product.images.length > 1) {
          <div class="thumbnail-gallery">
            @for (image of product.images; track image) {
              <img 
                [src]="image" 
                [alt]="product.name"
                [class.active]="selectedImage === image"
                (click)="selectImage(image)"
              />
            }
          </div>
        }
      </div>

      <div class="product-info-section">
        <p class="product-category">{{ product.category?.name }}</p>
        <h1 class="product-title">{{ product.name }}</h1>
        <p class="product-price">{{ product.basePrice | currency:'EUR':'symbol':'1.2-2':'fr-FR' }}</p>
        
        <div class="stock-info">
          @if (isAvailable()) {
            <span class="in-stock">
              ✓ En stock
            </span>
          } @else {
            <span class="out-of-stock">
              ✗ Rupture de stock
            </span>
          }
        </div>

        <p class="product-description">{{ product.description }}</p>

        <div class="product-options">
          @if (product.sizes && product.sizes.length > 0) {
            <div class="option-group">
              <label>Taille:</label>
              <div class="size-selector">
                @for (size of product.sizes; track size) {
                  <button 
                    [class.selected]="selectedSize === size"
                    (click)="selectSize(size)"
                    class="size-option">
                    {{ size }}
                  </button>
                }
              </div>
            </div>
          }

          @if (product.colors && product.colors.length > 0) {
            <div class="option-group">
              <label>Couleur:</label>
              <div class="color-selector">
                @for (color of product.colors; track color) {
                  <button 
                    [class.selected]="selectedColor === color"
                    (click)="selectColor(color)"
                    class="color-option"
                    [title]="color">
                    {{ color }}
                  </button>
                }
              </div>
            </div>
          }

          @if (isAvailable()) {
            <div class="option-group">
              <label>Quantité:</label>
              <div class="quantity-selector">
                <button (click)="decrementQuantity()" [disabled]="quantity <= 1">-</button>
                <span>{{ quantity }}</span>
                <button (click)="incrementQuantity()">+</button>
              </div>
            </div>
          }
        </div>

        <button 
          class="add-to-cart-button" 
          [disabled]="!isAvailable()"
          (click)="addToCart()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
          {{ isAvailable() ? 'Ajouter au panier' : 'Indisponible' }}
        </button>
      </div>
    </div>

    @if (product.reviews && product.reviews.length > 0) {
      <div class="reviews-section">
        <div class="reviews-header">
          <h2>Avis clients ({{ product.reviews.length }})</h2>
          <div class="average-rating">
            <div class="stars-display">
              @for (star of [1, 2, 3, 4, 5]; track star) {
                <svg width="20" height="20" viewBox="0 0 24 24" class="star" [class.filled]="star <= getAverageRating()">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
              }
            </div>
            <span class="rating-text">{{ getAverageRating() | number:'1.1-1' }}/5</span>
          </div>
        </div>

        <div class="reviews-list">
          @for (review of product.reviews; track review.id) {
            <div class="review-card">
              <div class="review-header">
                <div class="stars-display">
                  @for (star of [1, 2, 3, 4, 5]; track star) {
                    <svg width="16" height="16" viewBox="0 0 24 24" class="star" [class.filled]="star <= review.rating">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                  }
                </div>
                <span class="review-date">{{ review.createdAt | date:'dd/MM/yyyy' }}</span>
              </div>
              <p class="review-comment">{{ review.comment }}</p>
            </div>
          }
        </div>
      </div>
    }
  </div>
}