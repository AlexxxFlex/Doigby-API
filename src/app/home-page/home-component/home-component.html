<div class="api-container">
  <h2>Nos Produits</h2>

  <h3>DÃ©couvrez tous nos produits Doigby</h3>

  <app-list-product
    [products]="displayedProducts"
    categoryName=""
    (productSelected)="openSizeModal($event)">
  </app-list-product>

  <div 
    appInfiniteScroll 
    [threshold]="0.1"
    (scrolled)="loadMoreProducts()"
    class="loading-trigger">
    @if (isLoading) {
      <app-hamster-loader></app-hamster-loader>
    }
  </div>

  @if (showSizeModal) {
    <div class="modal-overlay" (click)="closeSizeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="closeSizeModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>

        <div class="modal-header">
          <img [src]="selectedProduct?.image" [alt]="selectedProduct?.name" class="modal-product-image" />
          <div>
            <h3>{{ selectedProduct?.name }}</h3>
            <p class="modal-price">{{ selectedProduct?.basePrice | currency:'EUR':'symbol':'1.2-2':'fr-FR' }}</p>
          </div>
        </div>

        <div class="modal-options">
          @if (selectedProduct?.sizes && selectedProduct?.sizes.length > 0) {
            <div class="option-section">
              <h4>Choisissez votre taille</h4>
              <div class="size-grid">
                @for (size of selectedProduct.sizes; track size) {
                  <button 
                    class="size-btn"
                    [class.selected]="selectedSize === size"
                    (click)="selectSize(size)">
                    {{ size }}
                  </button>
                }
              </div>
            </div>
          }

          @if (selectedProduct?.colors && selectedProduct?.colors.length > 0) {
            <div class="option-section">
              <h4>Choisissez votre couleur</h4>
              <div class="color-grid">
                @for (color of selectedProduct.colors; track color) {
                  <button 
                    class="color-btn"
                    [class.selected]="selectedColor === color"
                    (click)="selectColor(color)"
                    [title]="color">
                    {{ color }}
                  </button>
                }
              </div>
            </div>
          }
        </div>
        
        <button class="add-to-cart-modal-btn" (click)="addToCart()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
          Ajouter au panier
        </button>
      </div>
    </div>
  }
</div>